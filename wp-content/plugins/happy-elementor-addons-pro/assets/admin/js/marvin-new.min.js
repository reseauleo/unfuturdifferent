"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){function o(e,t){if(e=e,!(null!=(t=t)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}function m(e){try{JSON.parse(e)}catch(e){return}return 1}var l=function(){function e(){o(this,e)}return r(e,null,[{key:"prepare",value:function(e,t,n,o){var i=_.findIndex(e,function(e){return"clipboard"===e.name}),a=_.findIndex(e,function(e){return"addNew"===e.name});return 0<=a&&e[a].actions.push({name:"x-insert",title:"Add Nested Section",icon:"hm hm-happyaddons",callback:function(){c.insert(t)},isEnabled:function(){return!0}}),e.splice(i+1,0,{name:"hax-clipboard",actions:[{name:"x-copy",title:"X Copy",icon:"hm hm-happyaddons",shortcut:o,callback:function(){n.copy(t)}},{name:"x-copy-all",title:"X Copy All",icon:"hm hm-happyaddons",shortcut:"Content",callback:function(){n.copyAll()}},{name:"x-paste",title:"X Paste",icon:"hm hm-happyaddons",shortcut:"Live Paste",callback:function(){n.paste(t)}}]}),e}},{key:"prepareForBlankColumn",value:function(e,t,n){return e.push({name:"hax-clipboard",actions:[{name:"x-copy-all",title:"X Copy All",icon:"hm hm-happyaddons",shortcut:"Content",callback:function(){n.copyAll()}},{name:"x-paste",title:"X Paste",icon:"hm hm-happyaddons",shortcut:"Live Paste",callback:function(){n.paste(t)}}]}),e}}]),e}(),c=function(){function e(){o(this,e)}return r(e,null,[{key:"insert",value:function(e){e=e.getContainer().view;"column"===e.getElementType()&&e.addElement({elType:"section",isInner:!0,settings:{},elements:[{id:elementorCommon&&elementorCommon.helpers&&elementorCommon.helpers.getUniqueId()||elementor.helpers.getUniqueID,elType:"column",isInner:!0,settings:{_column_size:100},elements:[]}]})}}]),e}(),n=function(){function n(e,t){o(this,n),this.widgetType=e,this.widgetCode=t}return r(n,[{key:"getWidgetType",value:function(){return this.widgetType}},{key:"getWidgetCode",value:function(){return this.widgetCode}},{key:"toJSON",value:function(){return{widgetType:this.widgetType,widgetCode:this.widgetCode}}}]),n}(),e=function(){function t(e){o(this,t),this.widgetStorage=e,this.lastCopiedElement="",this.lastPastedElementModel={}}return r(t,[{key:"copy",value:function(e){e=new n(e.model.get("widgetType"),e.model.toJSON());navigator.clipboard.writeText(JSON.stringify(e)).then(function(){}).catch(function(e){console.error("Error copying text to clipboard: ",e)})}},{key:"copyAll",value:function(){var e=Object.values(elementor.getPreviewView().children._views).map(function(e){return e.getContainer()}).map(function(e){return e.model.toJSON()}),e=new n("page",e);navigator.clipboard.writeText(JSON.stringify(e)).then(function(){}).catch(function(e){console.error("Error copying text to clipboard: ",e)})}},{key:"paste",value:function(t){var n,o,e,a,r,l,c,p,s,d=this,u={};"firefox"==(s=(s=navigator.userAgent).match(/chrome|chromium|crios/i)?"chrome":s.match(/firefox|fxios/i)?"firefox":s.match(/safari/i)?"safari":s.match(/opr/ /i)?"opera":s.match(/edg/i)?"edge":"unknow")?(n=t.$el.closest("body"),0==(o=n.find(".ha-live-copy-dialog-box-wrap")).length&&(s="MacOS"==(s=window.navigator.userAgent,p="Unknown OS",-1!=s.indexOf("Win")&&(p="Windows"),-1!=s.indexOf("Mac")&&(p="MacOS"),-1!=s.indexOf("X11")&&(p="UNIX"),p=-1!=s.indexOf("Linux")?"Linux":p)?"Cmd + V":"Ctrl + V",p=jQuery("<div>",{class:"ha-live-copy-dialog-box-wrap open",contenteditable:"false"}),e=jQuery("<div>",{class:"ha-live-copy-dialog-box"}),a=jQuery("<input>",{class:"ha-live-copy-dialog-box-input",type:"text"}).attr("autocomplete","off"),r=jQuery("<span>",{class:"ha-live-copy-dialog-close-button"}).html('<i class="eicon-close"></i>'),s=jQuery("<div>",{class:"ha-live-copy-dialog-header"}).html(s),l=jQuery("<div>",{class:"ha-live-copy-dialog-message"}).html('<p class="ha-live-copy-dialog-description">To paste the element from your other site.</p>'),c=jQuery("<p>",{class:"ha-live-copy-dialog-error error-not-found"}).html("The action could not be completed. Make sure, Your clipboard is not empty or You are copying using HappyAddons xCopy or You are not pasting container on Elementor section."),e.append(a).append(r).append(s).append(l).append(c),p.append(e),n.append(p),o=p,n.find(".ha-live-copy-dialog-box-wrap input").focus(),n.find(".ha-live-copy-dialog-box-wrap").on("click",function(e){e.currentTarget!=e.target&&o.find(".ha-live-copy-dialog-close-button")[0]!=e.target&&o.find("i.eicon-close")[0]!=e.target||o.removeClass("open")})),o.hasClass("open")||(o.addClass("open"),n.find(".ha-live-copy-dialog-box-wrap input").focus()),n.find(".ha-live-copy-dialog-error").hasClass("error-not-found")||n.find(".ha-live-copy-dialog-error").addClass("error-not-found"),t.$el.closest("body").find(".ha-live-copy-dialog-box-wrap").on("paste.onFireFoxLivePaste","input",function(e){e.preventDefault();e=e.originalEvent.clipboardData.getData("text");if(m(e))return"object"!=_typeof(u=JSON.parse(e))||"object"==_typeof(u)&&!u.hasOwnProperty("widgetType")&&!u.hasOwnProperty("widgetCode")?n.find(".ha-live-copy-dialog-error").removeClass("error-not-found"):(g(u,d,t),o.removeClass("open")),void t.$el.closest("body").find(".ha-live-copy-dialog-box-wrap").off("paste.onFireFoxLivePaste");n.find(".ha-live-copy-dialog-error").removeClass("error-not-found"),t.$el.closest("body").find(".ha-live-copy-dialog-box-wrap").off("paste.onFireFoxLivePaste")})):navigator.clipboard.readText().then(function(e){m(e)&&("object"!=_typeof(u=JSON.parse(e))||"object"==_typeof(u)&&!u.hasOwnProperty("widgetType")&&!u.hasOwnProperty("widgetCode")?console.log("its not object or not found widgetType & widgetCode key"):g(u,d,t))}).catch(function(e){console.error("Error pasting text from clipboard: ",e)})}}]),t}(),t=elementor.hooks.addFilter,p=new e({});function g(e,n,t){var i;if("page"===e.widgetType&&e.widgetCode&&0<e.widgetCode.length)return i=elementor.$previewContents.find("html"),void jQuery.ajax({url:marvin.ajaxURL,method:"POST",data:{type:"import",action:"ha_process_ixport",nonce:marvin.nonce,content:JSON.stringify(e.widgetCode)},beforeSend:function(){i.addClass("ha-ixport").attr("data-ixport-text","Processing...")}}).done(function(e){var t,n,o;e.success&&(e=e.data[0],t=elementor.getPreviewContainer(),(n={}).at=t.view.collection.length,e.forEach(function(e){$e.run("document/elements/create",{container:t,model:e,options:n}),n.at++}),i.attr("data-ixport-text","Processing completed"),o=setTimeout(function(){i.removeClass("ha-ixport"),clearTimeout(o)},60))});var o,e=e.widgetCode,a=JSON.stringify(e),r=/\.(gif|jpg|jpeg|svg|png)/gi.test(a),l=t.model.get("elType"),c=e.elType,p={elType:c,settings:e.settings},s=null,d={at:0};if("section"===c?(o=null,"widget"===l?o=t.getContainer().parent.parent:"column"===l?o=t.getContainer().parent:"section"!==l&&"container"!==l||(o=t.getContainer()),p.elements=e.elements,s=o.parent,d.at=o.view.getOption("_index")+1,o.model.get("isInner")&&(p.isInner=!0)):"container"===c?(o=null,"widget"===l?o=(o=t.getContainer().parent.parent).parent?o:t.getContainer().parent:"column"===l?o=t.getContainer().parent:"section"!==l&&"container"!==l||(o=t.getContainer()),p.elements=e.elements,s=o.parent,d.at=o.view.getOption("_index")+1,o.model.get("isInner")&&(p.isInner=!0)):"column"===c?(p.elements=e.elements,"widget"===l?(s=t.getContainer().parent.parent,d.at=t.getContainer().parent.view.getOption("_index")+1):"column"===l?(s=t.getContainer().parent,d.at=t.getOption("_index")+1):"section"===l&&(s=t.getContainer())):"widget"===c&&(p.widgetType=e.widgetType,s=t.getContainer(),"widget"===l?(s=t.getContainer().parent,d.at=t.getOption("_index")+1):"column"===l?s=t.getContainer():"section"===l&&(s=t.children.findByIndex(0).getContainer())),r&&!_.isEmpty(n.lastPastedElementModel)&&n.lastCopiedElement===a)return d.clone=!0,void $e.run("document/elements/create",{model:n.lastPastedElementModel,container:s,options:d});var u=$e.run("document/elements/create",{model:p,container:s,options:d});r&&jQuery.ajax({url:marvin.ajaxURL,method:"POST",data:{type:"import",action:"ha_process_ixport",nonce:marvin.nonce,content:a},beforeSend:function(){u.view.$el.addClass("ha-ixport").attr("data-ixport-text","Processing...")}}).done(function(e){var t;e.success&&(e=e.data[0],p.settings=e.settings,p.elType=e.elType,"widget"===e.elType?p.widgetType=e.widgetType:p.elements=e.elements,u.view.$el.attr("data-ixport-text","Processing completed"),t=setTimeout(function(){$e.run("document/elements/delete",{container:u});var e=$e.run("document/elements/create",{model:p,container:s,options:d});n.lastPastedElementModel=elementorCommon.helpers.cloneObject(e.model.toJSON()),clearTimeout(t)},750))}),n.lastCopiedElement=a}t("elements/widget/contextMenuGroups",function(e,t){return l.prepare(e,t,p,"Widget")}),t("elements/container/contextMenuGroups",function(e,t){return l.prepare(e,t,p,"Container")}),t("elements/section/contextMenuGroups",function(e,t){return l.prepare(e,t,p,"Section")}),t("elements/column/contextMenuGroups",function(e,t){return l.prepare(e,t,p,"Column")}),t("element/view",function(t,e){var n;return"column"===e.get("elType")?t.extend({initialize:function(){t.prototype.initialize.apply(this,arguments),n=this},emptyView:t.prototype.emptyView.extend({getContextMenuGroups:function(){var e=t.prototype.emptyView.prototype.getContextMenuGroups.apply(this,arguments);return l.prepareForBlankColumn(e,n,p)}})}):t})}();